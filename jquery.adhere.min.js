!function(t){function i(i,a,e,r,s){var l=a.attr("id");if(l.match(/(ah-[0-9]+-[0-9]+)$/))var c=l.split(/-/),o={w:c[c.length-2],h:c[c.length-1]};var u=t(r).width()||0,h=t(r).height()||0,d=t(e).children(":nth-child(2)").get(0),p=t(e).children(":nth-child(1)").get(0),g=d.nodeName!=p.nodeName,f=1,m=!g&&""!=i.marker.html;a.css({position:"relative"}),"ontouchstart"in window&&(i.action.cEvent="click"),void 0!==o&&(0==u&&null!=o.w&&(u=o.w),0==h&&null!=o.h&&(h=o.h),o.w!=u&&(s=u/o.w)),i.collapseList&&(a.css({width:u+"px",height:h+"px"}),t(e).css({position:"absolute",top:"0",left:"0"}).children().css(i.collapseList?{position:"absolute"}:""));var $="adhere-"+l;if(!i.collapseList||m){var v=t('<div id="'+$+'"></div>').css({width:u+"px",height:h+"px"});t(r).wrap(v)}t(e).children(g?":even":"").each(function(a,e){var r,l,c,o,d=e.getAttribute("data-coords")||e.getAttribute("id"),p=null!=d?d.split(/-/):[0,0];if(null!=s&&(p[1]=(r=s,l=p[1],r*l),p[2]=(c=s,o=p[2],c*o)),p[1]>u?p[1]=u:(p[1]<0||null==p[1])&&(p[1]=0),p[2]>h?p[2]=h:(p[2]<0||null==p[2])&&(p[2]=0),!i.collapseList||m){var v=i.marker.html?i.marker.html:"<span>"+("ol"==i.captionContainer?a+1:"&bull;")+"</span>",x=e;e=t(v).css({position:"absolute"}).addClass(i.marker.className).appendTo(t("#"+$))}var A=new n(e,i,f);A.alignMarker.addClass().x(p[1]).y(p[2]),A.bindEvent(g||m),(g||m)&&(i.smart&&(i.caption.xAlign=A.smartAlign(p[1],u)),m&&null!=x&&(A.alignCaption.pair=x),A.alignCaption.addClass().x().y(),t(A.alignCaption.pair).hide()),f++})}function n(i,n,a){a=a||1;var e={xAligned:"",yAligned:"",alignMarker:{x:function(r){return e.xAligned=this.al(n.marker.xAlign,r,t(i).outerWidth(!0)),t(i).css({left:e.xAligned+"px","z-index":a}),this},y:function(a){return e.yAligned=this.al(n.marker.yAlign,a,t(i).outerHeight(!0)),t(i).css({top:e.yAligned+"px"}),this},al:function(t,i,n){switch(t){case"left":case"top":return i-n;case"right":case"bottom":return i+n;case"center":case"middle":return i-n/2;default:return 0}},addClass:function(){var a=n.marker.className||"";return t(i).addClass(a),this}},alignCaption:{pair:t(i).next()||"",x:function(a){return capxAligned=this.al(n.caption.xAlign,e.xAligned,t(this.pair).outerWidth(!0),t(i).outerWidth(!0),n.caption.xDistance),t(this.pair).css({left:capxAligned+"px"}),this},y:function(a,r){return capyAligned=this.al(n.caption.yAlign,e.yAligned,t(this.pair).outerHeight(!0),t(i).outerHeight(!0),n.caption.yDistance),t(this.pair).css({top:capyAligned+"px"}),this},al:function(t,i,n,a,e){var r=e||0;switch(t){case"left":case"top":return i-n-r;case"right":case"bottom":return i+a+r;case"center":case"middle":return i-n/2+a/2;default:return 0}},addClass:function(){var i=n.caption.className||"";return t(this.pair).addClass(i),this}},smartAlign:function(t,i){t=t||0;var a=i/2;return"smart-inner"==n.smart?t>a?"left":"right":"smart-outer"==n.smart?t>a?"right":"left":void 0},bindEvent:function(a){a=a||!1;var e=n.action.cEvent||"",r=n.action.cName||"";"function"==typeof r?t(i).bind(e,function(){r.call(this,i)}):a&&this.defaultCall()},defaultCall:function(){t(i).hover(function(){t(e.alignCaption.pair).fadeIn("fast")},function(){t(e.alignCaption.pair).fadeOut("fast")})}};return e}function a(t,i){return t*i}t.fn.adhere=function(n){return n=t.extend(!0,{captionContainer:"dl",collapseList:!0,smart:!1,marker:{className:"",xAlign:"center",yAlign:"center",html:""},caption:{className:"",xAlign:"center",yAlign:"center",xDistance:5,yDistance:5},action:{cEvent:"mouseover",cName:""}},n||{}),this.each(function(){var a,e=t(this),r=t(this).find(n.captionContainer).get(0),s=t(this).find("img").get(0);null!=s&&(s.complete||!t.browser.webkit?i(n,e,r,s,a):t(s).load(function(){i(n,e,r,s,a)}))})}}(jQuery);